--https://gis.stackexchange.com/questions/52571/deleting-points-outside-polygon-with-postgis

DELETE FROM points_table WHERE 
points_table.id IN (
    SELECT a.id FROM
      points_table a, polygon_table b
      WHERE NOT ST_Intersects(a.geom, b.geom)
 );

--CREATE TABLE layer_new AS SELECT a.* FROM layer a, boundary b 
--WHERE ST_Intersects(a.geom, b.geom);

--create table cla as select geom from city_boundaries where city_name ilike 'los angeles';
--create index idx_cla_geom on cla using gist(geom);
--delete from c4
--where ST_Intersects(c4.geom, cla.geom)
--;

create table c4 as select * from cams_points;
create index idx_c4_geom on c4 using gist(geom);

--didn't work				
DELETE FROM c4 WHERE 
c4.id IN (
    SELECT c4.id FROM
      c4 a, city_boundaries b
      WHERE ST_Intersects(a.geom, b.geom)
	and b.city_name ilike 'los angeles'
 );


--HOW TO
--spatial join, about 5-6 min
--note select polygons first, otherwise take all day...

create table c6 as select
cp.*,
cb.city_name as geo_city
from city_boundaries cb
left join cams_points cp
on ST_Intersects(cb.geom, cp.geom);
create index idx_c6_geom on c6 using gist(geom);

--then remove city of la

delete from c6 where geo_city ilike 'los angeles';

--use qgis to load la city addresses

--load from this table
insert into c6 (
	pretype,
	number,
	numsuffix,
	streetname,
	posttype,
	zipcode,
	geom
)
select
hse_dir_cd,
hse_nbr::integer,
hse_frac_nbr,
str_nm,
str_sfx_cd,
zip_cd,
ST_SetSRID(ST_MakePoint(x_coord_nbr::numeric, y_coord_nbr::numeric), 2229)
from public.addresses_lacity


--THEN
--load points from assessor parcels witn no cams points
--after removing points that successfully geocoded with the cams points locator





